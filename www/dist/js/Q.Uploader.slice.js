//devin87@qq.com
//build:2016/06/30 16:12:09
!function(e,t){"use strict";var n=(e.Blob||e.WebkitBlob||e.MozBlob,e.WebKitBlobBuilder||e.MozBlobBuilder,File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice),o=Q.Uploader;o.extend({_upload_slice:function(e){var t,i=this,a=e.blob||e.file,r=a.size,l=i.chunkSize,s=e.sliceStart||0,d=function(n,a){var l=new XMLHttpRequest,d=e.url,p=t==r;d+=(-1==d.indexOf("?")?"?":"&")+"action=upload&hash="+(e.hash||e.name)+"&ok="+(p?"1":"0"),l.upload.addEventListener("progress",function(t){i.progress(e,r,s+t.loaded)},!1),l.addEventListener("load",function(t){p&&i.complete(e,o.COMPLETE,t.target.responseText),a()},!1),l.addEventListener("error",function(){i.complete(e,UPLOAD_STATE_ERROR)},!1);var u=new FormData;p&&(i._process_params(e,function(e,t){u.append(e,t)}),u.append("fileName",e.name)),u.append(i.upName,n,e.name),l.open("POST",d),l.setRequestHeader("X-Requested-With","XMLHttpRequest"),p?i.fire("send",e,function(t){return t===!1?i.complete(e,o.SKIP):void l.send(u)}):l.send(u)},p=function(){if(!(s>=r)){t=s+l,t>r&&(t=r);var e=n.call(a,s,t);d(e,function(){s=t,p()})}};p(),i._afterSend(e)}})}(window);