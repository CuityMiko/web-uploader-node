//devin87@qq.com
//build:2017/08/23 11:31:56
!function(e,n){"use strict";var t=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,i=Q.Uploader;i.extend({_upload_slice:function(e){var n,o=this,a=e.blob||e.file,r=a.size,c=o.chunkSize,l=e.sliceStart||0,s=function(t,a){var c=new XMLHttpRequest,s=e.url,p=n==r;e.xhr=c,s+=(-1==s.indexOf("?")?"?":"&")+"action=upload&hash="+(e.hash||e.name)+"&ok="+(p?"1":"0"),c.upload.addEventListener("progress",function(n){o.progress(e,r,l+n.loaded)},!1),c.addEventListener("load",function(n){p&&o.complete(e,i.COMPLETE,n.target.responseText),a()},!1),c.addEventListener("error",function(){o.complete(e,i.ERROR)},!1);var d=new FormData;p&&(o._process_params(e,function(e,n){d.append(e,n)}),d.append("fileName",e.name)),d.append(o.upName,t,e.name),c.open("POST",s),p?o.fire("send",e,function(n){return n===!1?o.complete(e,i.SKIP):void c.send(d)}):c.send(d)};e.sliceCount=Math.ceil(r/c);var p=function(){l>=r||(n=l+c,n>r&&(n=r),e.sliceStart=l,e.sliceEnd=n,e.sliceIndex=Math.ceil(n/c),o.fire("sliceUpload",e,function(e){if(e===!1)return d();var i=t.call(a,l,n);s(i,d)}))},d=function(){l=n,p()};p(),o._afterSend(e)}})}(window);